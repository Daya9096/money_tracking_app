<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Wallet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {}
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <style>
    /* Custom scrollbar styling for dark mode */
    .overflow-y-auto::-webkit-scrollbar {
      width: 8px;
    }
    
    .overflow-y-auto::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .overflow-y-auto::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    
    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    
    /* Dark mode scrollbar */
    .dark .overflow-y-auto::-webkit-scrollbar-thumb {
      background: #4b5563;
    }
    
    .dark .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }
    
    /* Firefox scrollbar styling */
    .overflow-y-auto {
      scrollbar-width: thin;
      scrollbar-color: #d1d5db transparent;
    }
    
    .dark .overflow-y-auto {
      scrollbar-color: #4b5563 transparent;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-100 to-pink-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 font-sans transition-colors duration-200">
  <div class="w-full min-h-screen p-0 bg-white dark:bg-gray-800 rounded-none shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col transition-colors duration-200">
    <!-- Navbar INSIDE the block -->
        <nav id="mainNavbar" class="w-full flex items-center justify-between px-8 py-4 bg-white dark:bg-gray-800 shadow-none border-b border-gray-200 dark:border-gray-700 transition-colors duration-200">
      <!-- App Name -->
      <div class="flex items-center">
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg flex items-center justify-center shadow-lg">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 8v8"/>
          </svg>
        </div>
          <div class="flex flex-col">
            <span class="text-xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent dark:from-indigo-400 dark:via-purple-400 dark:to-pink-400">Money Manager</span>
            <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">Track • Save • Grow</span>
      </div>
        </div>
      </div>

      <!-- Center nav buttons -->
      <div class="flex space-x-6">
        <button id="homeNav" class="flex items-center px-3 py-1 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200 font-medium nav-btn active">
          <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"/></svg>
          Home
        </button>
        <button id="incomeNav" class="flex items-center px-3 py-1 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200 font-medium nav-btn">
          <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 8v8"/></svg>
          Income
        </button>
        <button id="expenseNav" class="flex items-center px-3 py-1 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200 font-medium nav-btn">
          <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 14v1a4 4 0 01-4 4H9a4 4 0 01-4-4v-1"/><path d="M12 11v-7m0 0L8 7m4-3l4 3"/></svg>
          Expense
        </button>
      </div>
      <div class="flex items-center space-x-4">
        <!-- Theme Toggle Button -->
        <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition focus:outline-none">
          <!-- Sun Icon for Light Mode -->
          <svg id="sunIcon" class="w-6 h-6 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <!-- Moon Icon for Dark Mode -->
          <svg id="moonIcon" class="w-6 h-6 text-gray-600 dark:text-gray-300 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
          </svg>
        </button>
        
      <div class="relative">
        <img id="profileBtn" src="https://i.ibb.co/1DCtw9v/Whats-App-Image-2025-04-04-at-17-07-55-a889790c.jpg" alt="Profile" class="w-14 h-14 rounded-full border-2 border-indigo-400 shadow cursor-pointer" />
        <!-- Profile Dropdown menu -->
          <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-44 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20">
            <button class="w-full text-left px-4 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200">Your Profile</button>
            <button class="w-full text-left px-4 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200">Settings</button>
            <button class="w-full text-left px-4 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700 text-red-600 dark:text-red-400">Sign Out</button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Home Section -->
    <div id="homeSection" class="h-screen flex flex-col">
      <!-- Fixed Header Area -->
      <div class="flex-shrink-0">
      <!-- Total Balance Card -->
      <div class="bg-gradient-to-r from-indigo-200 via-purple-200 to-pink-200 p-6 rounded-2xl shadow-lg mb-8 relative border border-indigo-100 mx-8 mt-6">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-base text-gray-600 font-medium">Total Balance</p>
            <h2 id="totalBalance" class="text-4xl font-extrabold text-gray-900 mt-1"></h2>
          </div>
          <div class="relative">
            <button id="calendarBtn" class="p-2 rounded-lg hover:bg-indigo-100 transition focus:outline-none">
              <!-- Calendar Icon -->
              <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <rect x="3" y="8" width="18" height="13" rx="2" ry="2" />
                <path d="M16 2v4M8 2v4M3 10h18" />
              </svg>
            </button>
              <div id="dateRangePicker" class="absolute right-0 mt-2 p-4 rounded-lg border border-gray-300 shadow bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 hidden z-10 min-w-[280px]">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-sm font-semibold text-gray-700">Date Range</span>
                  <button id="clearDateRange" class="text-xs text-indigo-600 hover:text-indigo-800">Clear</button>
                </div>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">From Date</label>
                    <input type="date" id="startDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">To Date</label>
                    <input type="date" id="endDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
                  </div>
                  <button id="applyDateRange" class="w-full bg-indigo-600 text-white py-2 rounded text-sm font-semibold hover:bg-indigo-700 transition">Apply Filter</button>
                </div>
              </div>
          </div>
        </div>
        <span class="text-green-600 text-lg font-semibold mt-3 inline-block">+49.89%</span>
      </div>

      <!-- Sort Row -->
        <div class="flex justify-between items-center mb-4 text-base text-gray-500 dark:text-gray-400 px-8">
        <p>Sort by</p>
          <select id="userFilterHome" class="ml-2 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700">
            <option value="all">All</option>
          </select>
        </div>
      </div>

      <!-- Scrollable Transactions Area -->
      <div class="flex-1 overflow-y-auto px-8 pb-8">
        <div id="recentTransactionCards" class="space-y-4"></div>
        <div id="recentTransactions" class="bg-white dark:bg-gray-700 rounded-xl shadow p-4 mt-8 mb-8"></div>
          </div>
        </div>

    <!-- Income Section -->
    <div id="incomeSection" class="hidden h-screen flex flex-col">
      <!-- Fixed Header Area -->
      <div class="flex-shrink-0 px-8">
        <div class="bg-gradient-to-r from-green-100 via-green-200 to-green-300 p-6 rounded-2xl shadow-lg mb-8 border border-green-200 mt-6">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-base text-gray-600 font-medium">Total Income</p>
              <h2 id="incomeBalance" class="text-3xl font-extrabold text-gray-900 mt-1">₹0</h2>
            </div>
            <div class="relative">
              <button id="incomeCalendarBtn" class="p-2 rounded-lg hover:bg-green-100 transition focus:outline-none">
                <!-- Calendar Icon -->
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <rect x="3" y="8" width="18" height="13" rx="2" ry="2" />
                  <path d="M16 2v4M8 2v4M3 10h18" />
                </svg>
              </button>
              <div id="incomeDateRangePicker" class="absolute right-0 mt-2 p-4 rounded-lg border border-gray-300 shadow bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-300 hidden z-10 min-w-[280px]">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-sm font-semibold text-gray-700">Date Range</span>
                  <button id="clearIncomeDateRange" class="text-xs text-green-600 hover:text-green-800">Clear</button>
          </div>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">From Date</label>
                    <input type="date" id="incomeStartDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
          </div>
            <div>
                    <label class="block text-xs text-gray-600 mb-1">To Date</label>
                    <input type="date" id="incomeEndDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
            </div>
                  <button id="applyIncomeDateRange" class="w-full bg-green-600 text-white py-2 rounded text-sm font-semibold hover:bg-green-700 transition">Apply Filter</button>
          </div>
          </div>
        </div>
      </div>
    </div>
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-green-700">Income Transactions</h3>
          <div class="flex items-center space-x-2">
            <span class="text-base text-gray-500 dark:text-gray-400">Sort by</span>
            <select id="userFilterIncome" class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700">
              <option value="all">All</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Scrollable Transactions Area -->
      <div class="flex-1 overflow-y-auto px-8 pb-8">
        <div id="incomeTransactions" class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 min-h-[60px]">
          <p class="text-gray-500 dark:text-gray-400">No income transactions yet.</p>
      </div>
      </div>
      
      <!-- Floating Action Button for Income -->
      <button id="addIncomeFAB" class="fixed bottom-8 right-8 w-16 h-16 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110 z-20">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M12 4v16m8-8H4"/>
        </svg>
      </button>
    </div>

    <!-- Expense Section -->
    <div id="expenseSection" class="hidden h-screen flex flex-col">
      <!-- Fixed Header Area -->
      <div class="flex-shrink-0 px-8">
      <div class="bg-gradient-to-r from-red-100 via-red-200 to-red-300 p-6 rounded-2xl shadow-lg mb-8 border border-red-200 mt-6">
        <div class="flex justify-between items-center">
          <div>
            <p class="text-base text-gray-600 font-medium">Total Expense</p>
            <h2 id="expenseBalance" class="text-3xl font-extrabold text-gray-900 mt-1">₹0</h2>
          </div>
            <div class="relative">
              <button id="expenseCalendarBtn" class="p-2 rounded-lg hover:bg-red-100 transition focus:outline-none">
                <!-- Calendar Icon -->
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <rect x="3" y="8" width="18" height="13" rx="2" ry="2" />
                  <path d="M16 2v4M8 2v4M3 10h18" />
                </svg>
              </button>
              <div id="expenseDateRangePicker" class="absolute right-0 mt-2 p-4 rounded-lg border border-gray-300 shadow bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-300 hidden z-10 min-w-[280px]">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-sm font-semibold text-gray-700">Date Range</span>
                  <button id="clearExpenseDateRange" class="text-xs text-red-600 hover:text-red-800">Clear</button>
        </div>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">From Date</label>
                    <input type="date" id="expenseStartDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
      </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">To Date</label>
                    <input type="date" id="expenseEndDate" class="w-full p-2 border border-gray-300 rounded text-sm" />
                  </div>
                  <button id="applyExpenseDateRange" class="w-full bg-red-600 text-white py-2 rounded text-sm font-semibold hover:bg-red-700 transition">Apply Filter</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-red-700">Expense Transactions</h3>
          <div class="flex items-center space-x-2">
            <span class="text-base text-gray-500 dark:text-gray-400">Sort by</span>
            <select id="userFilterExpense" class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700">
              <option value="all">All</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Scrollable Transactions Area -->
      <div class="flex-1 overflow-y-auto px-8 pb-8">
        <div id="expenseTransactions" class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 min-h-[60px]">
          <p class="text-gray-500 dark:text-gray-400">No expense transactions yet.</p>
        </div>
      </div>
      
      <!-- Floating Action Button for Expense -->
      <button id="addExpenseFAB" class="fixed bottom-8 right-8 w-16 h-16 bg-red-600 hover:bg-red-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110 z-20">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M12 4v16m8-8H4"/>
        </svg>
      </button>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md relative animate-fadeIn">
        <button id="closeSettingsModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 text-2xl">&times;</button>
        <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Settings</h2>
        
        <!-- Settings Options -->
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <span class="text-gray-700 dark:text-gray-200">Notifications</span>
            <button class="text-indigo-600 dark:text-indigo-400 text-sm font-medium">Configure</button>
          </div>
          
          <!-- Region/Country Selection -->
          <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <label class="block text-gray-700 dark:text-gray-200 mb-2">Region/Country</label>
            <select id="countrySelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200">
              <option value="IN">🇮🇳 India</option>
              <option value="US">🇺🇸 United States</option>
              <option value="GB">🇬🇧 United Kingdom</option>
              <option value="CA">🇨🇦 Canada</option>
              <option value="AU">🇦🇺 Australia</option>
              <option value="DE">🇩🇪 Germany</option>
              <option value="FR">🇫🇷 France</option>
              <option value="JP">🇯🇵 Japan</option>
              <option value="CN">🇨🇳 China</option>
              <option value="BR">🇧🇷 Brazil</option>
              <option value="MX">🇲🇽 Mexico</option>
              <option value="SG">🇸🇬 Singapore</option>
              <option value="AE">🇦🇪 UAE</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Nav INSIDE the block -->
    <!-- Removed bottom navigation bar as requested -->
  </div>

  <!-- Transaction Details Modal (Global) -->
  <div id="transactionModal" class="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div id="transactionModalBox" class="bg-gradient-to-r from-indigo-100 via-purple-100 to-pink-100 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md relative animate-fadeIn text-center">
      <button id="closeTransactionModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 text-3xl font-bold transition">&times;</button>
      <div id="modalType" class="text-3xl font-extrabold mb-6 mt-2 text-black dark:text-white"></div>
      <div id="modalAmount" class="text-4xl font-extrabold mb-4"></div>
      <div class="mb-3 text-lg text-gray-800 dark:text-gray-200"><span class="font-semibold">Source:</span> <span id="modalSource"></span></div>
      <div class="mb-3 text-lg text-gray-800 dark:text-gray-200"><span class="font-semibold">Date:</span> <span id="modalDate"></span></div>
      <div class="mb-3 text-lg text-gray-800 dark:text-gray-200"><span class="font-semibold">Added by:</span> <span id="modalUser"></span></div>
      
      <!-- Delete Button -->
      <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-600">
        <button id="deleteTransactionBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          <span>Delete Transaction</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Add Income Modal -->
  <div id="addIncomeModal" class="fixed inset-0 z-30 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md relative">
      <button id="closeIncomeModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold mb-4 text-indigo-700">Add Income</h2>
      <form id="incomeForm" class="space-y-4">
        <div>
          <label for="incomeName" class="block text-gray-700 mb-1">Name</label>
          <input type="text" id="incomeName" class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100" readonly />
        </div>
        <div>
          <label for="incomeSource" class="block text-gray-700 mb-1">Source of Income</label>
          <input type="text" id="incomeSource" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="e.g. Salary, Freelance" required />
        </div>
        <div>
          <label for="incomeAmount" class="block text-gray-700 mb-1">Amount (INR)</label>
          <div class="flex items-center">
            <span class="text-lg text-gray-500 mr-2">₹</span>
            <input type="number" id="incomeAmount" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Amount" min="0" required />
          </div>
        </div>
        <div>
          <label for="incomeDate" class="block text-gray-700 mb-1">Date & Time</label>
          <input type="datetime-local" id="incomeDate" class="w-full p-2 border border-gray-300 rounded-lg" required />
        </div>
        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Add Income</button>
      </form>
    </div>
  </div>

  <!-- Add Expense Modal -->
  <div id="addExpenseModal" class="fixed inset-0 z-30 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md relative">
      <button id="closeExpenseModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold mb-4 text-red-600">Add Expense</h2>
      <form id="expenseForm" class="space-y-4">
        <div>
          <label for="expenseName" class="block text-gray-700 mb-1">Name</label>
          <input type="text" id="expenseName" class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100" readonly />
        </div>
        <div>
          <label for="expenseSource" class="block text-gray-700 mb-1">Source of Expense</label>
          <input type="text" id="expenseSource" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="e.g. Food, Rent" required />
        </div>
        <div>
          <label for="expenseAmount" class="block text-gray-700 mb-1">Amount (INR)</label>
          <div class="flex items-center">
            <span class="text-lg text-gray-500 mr-2">₹</span>
            <input type="number" id="expenseAmount" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Amount" min="0" required />
          </div>
        </div>
        <div>
          <label for="expenseDate" class="block text-gray-700 mb-1">Date & Time</label>
          <input type="datetime-local" id="expenseDate" class="w-full p-2 border border-gray-300 rounded-lg" required />
        </div>
        <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition">Add Expense</button>
      </form>
    </div>
  </div>

      <!-- Profile Section -->
    <div id="profileSection" class="hidden fixed inset-0 z-50 flex flex-col bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
      <!-- Custom Navbar for Profile -->
      <nav class="w-full flex items-center justify-between px-8 py-4 bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700">
        <!-- Left Side: App Logo and Name -->
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg flex items-center justify-center shadow-lg">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 8v8"/>
            </svg>
          </div>
          <div class="flex flex-col">
            <span class="text-xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent dark:from-indigo-400 dark:via-purple-400 dark:to-pink-400">Money Manager</span>
            <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">Track • Save • Grow</span>
          </div>
        </div>

        <!-- Center: Your Profile Text -->
        <div class="absolute left-1/2 transform -translate-x-1/2">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent dark:from-indigo-400 dark:via-purple-400 dark:to-pink-400">Your Profile</h1>
        </div>

        <!-- Right Side: Go to Dashboard Button -->
        <button id="profileNavbarDashboardBtn" class="px-6 py-2.5 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 hover:shadow-lg transition-all duration-300 flex items-center space-x-2 border border-indigo-500/20 shadow-md">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"/>
          </svg>
          <span class="font-medium">Go to Dashboard</span>
        </button>
      </nav>

      <!-- Profile Content -->
      <div class="flex-1 flex items-center justify-center w-full p-8 overflow-y-auto">
        <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl border border-white/20 w-full max-w-6xl animate-slide-up my-8">
          <!-- Top Section: Photo Change -->
          <div class="flex items-center justify-between p-8 border-b border-gray-200 dark:border-gray-700">
            <!-- Left: Empty space for balance -->
            <div class="w-32"></div>

            <!-- Center: Photo Change -->
            <div class="flex flex-col items-center">
              <div id="profileAvatarPreview" class="w-24 h-24 rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center mb-3 overflow-hidden border-4 border-indigo-200 shadow-lg">
                <img id="profileAvatarImg" src="https://i.ibb.co/1DCtw9v/Whats-App-Image-2025-04-04-at-17-07-55-a889790c.jpg" alt="Profile" class="w-full h-full object-cover" />
              </div>
              <label for="profilePhotoInput" class="cursor-pointer text-indigo-600 hover:text-indigo-700 hover:underline text-sm font-medium transition-colors bg-indigo-50 hover:bg-indigo-100 px-3 py-1.5 rounded-lg">Change Photo</label>
              <input type="file" id="profilePhotoInput" accept="image/*" class="hidden" />
            </div>

            <!-- Right: Empty space for balance -->
            <div class="w-32"></div>
          </div>

          <!-- Bottom Section: Two Columns -->
          <div class="flex flex-col lg:flex-row min-h-0">
            <!-- Left Column: Personal Information -->
            <div class="flex-1 p-8 border-r border-gray-200 dark:border-gray-700">
              <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-3 text-indigo-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                Personal Information
              </h3>
              <div class="space-y-4">
                <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <div class="flex items-center justify-between">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">Name:</span>
                    <span id="profileName" class="text-gray-800 dark:text-gray-200 font-medium"></span>
                  </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <div class="flex items-center justify-between">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">Email:</span>
                    <span id="profileEmail" class="text-gray-800 dark:text-gray-200 font-medium"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column: Change Password -->
            <div class="flex-1 p-8">
              <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-3 text-indigo-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                Change Password
              </h3>
              <form id="changePasswordForm" class="space-y-4">
                <div class="space-y-3">
                  <input type="password" id="currentPassword" placeholder="Current Password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" required />
                  <input type="password" id="newPassword" placeholder="New Password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" required />
                  <input type="password" id="confirmNewPassword" placeholder="Confirm New Password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" required />
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white py-3 rounded-xl font-semibold hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 hover:shadow-lg transition-all duration-300 border border-indigo-500/20 shadow-md">Update Password</button>
                <div id="passwordChangeMsg" class="text-center text-sm mt-2"></div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Protect dashboard: redirect if not logged in
    console.log('isLoggedIn:', localStorage.getItem('isLoggedIn'));
    if (localStorage.getItem('isLoggedIn') !== 'true') {
      window.location.href = 'login.html';
    }

    // Logout logic for Sign Out button in profile dropdown
    const signOutBtn = document.querySelector('#profileDropdown button:last-child');
    if (signOutBtn) {
      signOutBtn.addEventListener('click', function() {
        // Preserve avatar before clearing
        const savedAvatar = localStorage.getItem('userAvatar');
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userName');
        localStorage.removeItem('userEmail');
        // Restore avatar
        if (savedAvatar) {
          localStorage.setItem('userAvatar', savedAvatar);
        }
        
        // Show spicy logout message and login link
        document.body.innerHTML = `
          <div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-100 to-pink-100 flex items-center justify-center p-4">
            <!-- Background Animation -->
            <div class="absolute inset-0 overflow-hidden">
              <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-indigo-400 to-purple-600 rounded-full opacity-20 animate-pulse"></div>
              <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-br from-pink-400 to-red-600 rounded-full opacity-20 animate-pulse delay-1000"></div>
            </div>
            
            <!-- Main Container -->
            <div class="relative z-10 w-full max-w-md">
              <!-- App Logo & Title -->
              <div class="text-center mb-8 animate-bounce-in">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-2xl shadow-2xl mb-4">
                  <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 8v8"/>
                  </svg>
                </div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-4 pb-1">
                  Money Manager
                </h1>
                <h2 class="text-2xl font-bold bg-gradient-to-r from-green-600 to-green-700 bg-clip-text text-transparent mb-2">
                  Logout Successful!
                </h2>
              </div>

              <!-- Logout Message -->
              <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-2xl p-8 border border-white/20 animate-slide-up">
                <div class="text-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800 mb-4">See You Soon!</h2>
                  <p class="text-gray-600 mb-6">Thank you for using Money Manager. Your data is safe and secure.</p>
                  
                  <!-- Success Animation -->
                  <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-full mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  
                  <p class="text-sm text-gray-500 mb-6">Come back anytime to continue tracking your finances!</p>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-4">
                  <a href="login.html" class="w-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                    </svg>
                    <span>Sign In Again</span>
                  </a>
                  
                  <a href="signup.html" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                    </svg>
                    <span>Create New Account</span>
                  </a>
                </div>
              </div>

              <!-- Footer -->
              <div class="text-center mt-8 text-gray-500 text-sm">
                <p>© 2024 Money Manager. All rights reserved.</p>
              </div>
            </div>
          </div>
        `;
      });
    }

    // Date range picker logic
    const calendarBtn = document.getElementById('calendarBtn');
    const dateRangePicker = document.getElementById('dateRangePicker');
    const startDate = document.getElementById('startDate');
    const endDate = document.getElementById('endDate');
    const applyDateRange = document.getElementById('applyDateRange');
    const clearDateRange = document.getElementById('clearDateRange');
    
    // Set default dates (last 30 days)
    const today = new Date();
    const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
    startDate.value = thirtyDaysAgo.toISOString().split('T')[0];
    endDate.value = today.toISOString().split('T')[0];
    
    calendarBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      dateRangePicker.classList.toggle('hidden');
    });
    
    document.addEventListener('click', function(e) {
      if (!dateRangePicker.classList.contains('hidden')) {
        dateRangePicker.classList.add('hidden');
      }
    });
    
    dateRangePicker.addEventListener('click', function(e) {
      e.stopPropagation();
    });
    
    // Apply date range filter
    applyDateRange.addEventListener('click', function() {
      const start = startDate.value;
      const end = endDate.value;
      
      if (start && end) {
        localStorage.setItem('dateRangeStart', start);
        localStorage.setItem('dateRangeEnd', end);
        updateHomeTab(); // Refresh with date filter
        dateRangePicker.classList.add('hidden');
      }
    });
    
    // Clear date range filter
    clearDateRange.addEventListener('click', function() {
      startDate.value = '';
      endDate.value = '';
      localStorage.removeItem('dateRangeStart');
      localStorage.removeItem('dateRangeEnd');
      updateHomeTab(); // Refresh without date filter
      dateRangePicker.classList.add('hidden');
    });
    
    // Load saved date range on page load
    const savedStart = localStorage.getItem('dateRangeStart');
    const savedEnd = localStorage.getItem('dateRangeEnd');
    if (savedStart) startDate.value = savedStart;
    if (savedEnd) endDate.value = savedEnd;
    
    // Income date range picker logic
    const incomeCalendarBtn = document.getElementById('incomeCalendarBtn');
    const incomeDateRangePicker = document.getElementById('incomeDateRangePicker');
    const incomeStartDate = document.getElementById('incomeStartDate');
    const incomeEndDate = document.getElementById('incomeEndDate');
    const applyIncomeDateRange = document.getElementById('applyIncomeDateRange');
    const clearIncomeDateRange = document.getElementById('clearIncomeDateRange');
    
    // Set default dates for income (last 30 days)
    incomeStartDate.value = thirtyDaysAgo.toISOString().split('T')[0];
    incomeEndDate.value = today.toISOString().split('T')[0];
    
    incomeCalendarBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      incomeDateRangePicker.classList.toggle('hidden');
    });
    
    document.addEventListener('click', function(e) {
      if (!incomeDateRangePicker.classList.contains('hidden')) {
        incomeDateRangePicker.classList.add('hidden');
      }
    });
    
    incomeDateRangePicker.addEventListener('click', function(e) {
      e.stopPropagation();
    });

    // Apply income date range filter
    applyIncomeDateRange.addEventListener('click', function() {
      const start = incomeStartDate.value;
      const end = incomeEndDate.value;
      
      if (start && end) {
        localStorage.setItem('incomeDateRangeStart', start);
        localStorage.setItem('incomeDateRangeEnd', end);
        fetchIncomes().then(renderIncomeTransactions); // Refresh with date filter
        incomeDateRangePicker.classList.add('hidden');
      }
    });
    
    // Clear income date range filter
    clearIncomeDateRange.addEventListener('click', function() {
      incomeStartDate.value = '';
      incomeEndDate.value = '';
      localStorage.removeItem('incomeDateRangeStart');
      localStorage.removeItem('incomeDateRangeEnd');
      fetchIncomes().then(renderIncomeTransactions); // Refresh without date filter
      incomeDateRangePicker.classList.add('hidden');
    });
    
    // Load saved income date range on page load
    const savedIncomeStart = localStorage.getItem('incomeDateRangeStart');
    const savedIncomeEnd = localStorage.getItem('incomeDateRangeEnd');
    if (savedIncomeStart) incomeStartDate.value = savedIncomeStart;
    if (savedIncomeEnd) incomeEndDate.value = savedIncomeEnd;
    
    // Expense date range picker logic
    const expenseCalendarBtn = document.getElementById('expenseCalendarBtn');
    const expenseDateRangePicker = document.getElementById('expenseDateRangePicker');
    const expenseStartDate = document.getElementById('expenseStartDate');
    const expenseEndDate = document.getElementById('expenseEndDate');
    const applyExpenseDateRange = document.getElementById('applyExpenseDateRange');
    const clearExpenseDateRange = document.getElementById('clearExpenseDateRange');
    
    // Set default dates for expense (last 30 days)
    expenseStartDate.value = thirtyDaysAgo.toISOString().split('T')[0];
    expenseEndDate.value = today.toISOString().split('T')[0];
    
    expenseCalendarBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      expenseDateRangePicker.classList.toggle('hidden');
    });
    
    document.addEventListener('click', function(e) {
      if (!expenseDateRangePicker.classList.contains('hidden')) {
        expenseDateRangePicker.classList.add('hidden');
      }
    });
    
    expenseDateRangePicker.addEventListener('click', function(e) {
      e.stopPropagation();
    });
    
    // Apply expense date range filter
    applyExpenseDateRange.addEventListener('click', function() {
      const start = expenseStartDate.value;
      const end = expenseEndDate.value;
      
      if (start && end) {
        localStorage.setItem('expenseDateRangeStart', start);
        localStorage.setItem('expenseDateRangeEnd', end);
        fetchExpenses().then(renderExpenseTransactions); // Refresh with date filter
        expenseDateRangePicker.classList.add('hidden');
      }
    });
    
    // Clear expense date range filter
    clearExpenseDateRange.addEventListener('click', function() {
      expenseStartDate.value = '';
      expenseEndDate.value = '';
      localStorage.removeItem('expenseDateRangeStart');
      localStorage.removeItem('expenseDateRangeEnd');
      fetchExpenses().then(renderExpenseTransactions); // Refresh without date filter
      expenseDateRangePicker.classList.add('hidden');
    });
    
    // Load saved expense date range on page load
    const savedExpenseStart = localStorage.getItem('expenseDateRangeStart');
    const savedExpenseEnd = localStorage.getItem('expenseDateRangeEnd');
    if (savedExpenseStart) expenseStartDate.value = savedExpenseStart;
    if (savedExpenseEnd) expenseEndDate.value = savedExpenseEnd;
    
    // Settings Modal and Theme Toggle Logic
    const settingsBtn = document.querySelector('#profileDropdown button:nth-child(2)');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsModal = document.getElementById('closeSettingsModal');
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    
    // Load saved theme preference
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
      document.documentElement.classList.add('dark');
      // Show sun icon when in dark mode (to switch to light)
      sunIcon.classList.remove('hidden');
      moonIcon.classList.add('hidden');
    } else {
      document.documentElement.classList.remove('dark');
      // Show moon icon when in light mode (to switch to dark)
      sunIcon.classList.add('hidden');
      moonIcon.classList.remove('hidden');
    }
    
    // Settings button click handler
    settingsBtn.addEventListener('click', function() {
      settingsModal.classList.remove('hidden');
      document.getElementById('profileDropdown').classList.add('hidden');
    });
    
    // Close settings modal
    closeSettingsModal.addEventListener('click', function() {
      settingsModal.classList.add('hidden');
    });
    
    settingsModal.addEventListener('click', function(e) {
      if (e.target === settingsModal) {
        settingsModal.classList.add('hidden');
      }
    });
    
    // Theme toggle functionality
    themeToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const isDark = document.documentElement.classList.contains('dark');
      console.log('Current theme:', isDark ? 'dark' : 'light');
      console.log('Theme toggle clicked!');
      
      if (isDark) {
        // Switch to light mode (currently showing sun icon)
        document.documentElement.classList.remove('dark');
        // Switch to moon icon (for switching to dark)
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
        localStorage.setItem('theme', 'light');
        console.log('Switched to light mode');
      } else {
        // Switch to dark mode (currently showing moon icon)
        document.documentElement.classList.add('dark');
        // Switch to sun icon (for switching to light)
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
        localStorage.setItem('theme', 'dark');
        console.log('Switched to dark mode');
      }
    });
    
    // Floating Action Button logic
    const addIncomeFAB = document.getElementById('addIncomeFAB');
    const addExpenseFAB = document.getElementById('addExpenseFAB');
    
    // Initially hide both FABs
    addIncomeFAB.classList.add('hidden');
    addExpenseFAB.classList.add('hidden');
    
    // Set default date and time for datetime inputs
    function setDefaultDateTime() {
      const country = countrySelect ? countrySelect.value : 'IN';
      const countryData = countryCurrencyMap[country];
      
      if (countryData) {
        // Get current time in the selected country's timezone
        const now = new Date();
        
        // Convert to the target timezone
        const targetTime = new Date(now.toLocaleString("en-US", {timeZone: countryData.timezone}));
        
        // Format for datetime-local input (YYYY-MM-DDTHH:MM)
        const year = targetTime.getFullYear();
        const month = String(targetTime.getMonth() + 1).padStart(2, '0');
        const day = String(targetTime.getDate()).padStart(2, '0');
        const hours = String(targetTime.getHours()).padStart(2, '0');
        const minutes = String(targetTime.getMinutes()).padStart(2, '0');
        
        const dateTimeString = `${year}-${month}-${day}T${hours}:${minutes}`;
        
        // Set default values for both modals
        const incomeDateInput = document.getElementById('incomeDate');
        const expenseDateInput = document.getElementById('expenseDate');
        
        if (incomeDateInput) incomeDateInput.value = dateTimeString;
        if (expenseDateInput) expenseDateInput.value = dateTimeString;
      } else {
        // Fallback to default
        const now = new Date();
        const dateTimeString = now.toISOString().slice(0, 16);
        
        const incomeDateInput = document.getElementById('incomeDate');
        const expenseDateInput = document.getElementById('expenseDate');
        
        if (incomeDateInput) incomeDateInput.value = dateTimeString;
        if (expenseDateInput) expenseDateInput.value = dateTimeString;
      }
    }
    
    // Country and currency mapping
    const countryCurrencyMap = {
      'IN': { currency: 'INR', symbol: '₹', locale: 'en-IN', timezone: 'Asia/Kolkata' },
      'US': { currency: 'USD', symbol: '$', locale: 'en-US', timezone: 'America/New_York' },
      'GB': { currency: 'GBP', symbol: '£', locale: 'en-GB', timezone: 'Europe/London' },
      'CA': { currency: 'CAD', symbol: 'C$', locale: 'en-CA', timezone: 'America/Toronto' },
      'AU': { currency: 'AUD', symbol: 'A$', locale: 'en-AU', timezone: 'Australia/Sydney' },
      'DE': { currency: 'EUR', symbol: '€', locale: 'de-DE', timezone: 'Europe/Berlin' },
      'FR': { currency: 'EUR', symbol: '€', locale: 'fr-FR', timezone: 'Europe/Paris' },
      'JP': { currency: 'JPY', symbol: '¥', locale: 'ja-JP', timezone: 'Asia/Tokyo' },
      'CN': { currency: 'CNY', symbol: '¥', locale: 'zh-CN', timezone: 'Asia/Shanghai' },
      'BR': { currency: 'BRL', symbol: 'R$', locale: 'pt-BR', timezone: 'America/Sao_Paulo' },
      'MX': { currency: 'MXN', symbol: '$', locale: 'es-MX', timezone: 'America/Mexico_City' },
      'SG': { currency: 'SGD', symbol: 'S$', locale: 'en-SG', timezone: 'Asia/Singapore' },
      'AE': { currency: 'AED', symbol: 'د.إ', locale: 'ar-AE', timezone: 'Asia/Dubai' }
    };

    // Only keep countrySelect and its logic
    const countrySelect = document.getElementById('countrySelect');
    const savedCountry = localStorage.getItem('selectedCountry') || 'IN';
    countrySelect.value = savedCountry;
    localStorage.setItem('selectedCountry', countrySelect.value); // Ensure localStorage and dropdown are always in sync
    updateHomeTab();

    // Call updateHomeTab after setting country, so the correct symbol is used
    countrySelect.addEventListener('change', function() {
      const country = this.value;
      localStorage.setItem('selectedCountry', country);
      updateDateTimeFormat();
      updateHomeTab(); // Always refresh Home tab total balance with new symbol
      Promise.all([fetchIncomes(), fetchExpenses()]).then(([incomes, expenses]) => {
        // Re-render balances for other tabs
        renderBalances(
          incomes.reduce((sum, inc) => sum + inc.amount, 0),
          expenses.reduce((sum, exp) => sum + exp.amount, 0)
        );
        if (!document.getElementById('incomeSection').classList.contains('hidden')) {
          renderIncomeTransactions(incomes);
        }
        if (!document.getElementById('expenseSection').classList.contains('hidden')) {
          renderExpenseTransactions(expenses);
        }
      });
    });

    // Update date/time format based on selected country
    function updateDateTimeFormat() {
      const country = countrySelect.value;
      const countryData = countryCurrencyMap[country];
      if (countryData) {
        // Get current time in the selected country's timezone
        const now = new Date();
        // Convert to the target timezone
        const targetTime = new Date(now.toLocaleString("en-US", {timeZone: countryData.timezone}));
        // Format for datetime-local input (YYYY-MM-DDTHH:MM)
        const year = targetTime.getFullYear();
        const month = String(targetTime.getMonth() + 1).padStart(2, '0');
        const day = String(targetTime.getDate()).padStart(2, '0');
        const hours = String(targetTime.getHours()).padStart(2, '0');
        const minutes = String(targetTime.getMinutes()).padStart(2, '0');
        const dateTimeString = `${year}-${month}-${day}T${hours}:${minutes}`;
        const incomeDateInput = document.getElementById('incomeDate');
        const expenseDateInput = document.getElementById('expenseDate');
        if (incomeDateInput) incomeDateInput.value = dateTimeString;
        if (expenseDateInput) expenseDateInput.value = dateTimeString;
      }
    }

    // Set default date time on page load
    setDefaultDateTime();
    updateDateTimeFormat();
    
    // Add Income FAB click handler
    addIncomeFAB.addEventListener('click', function() {
      document.getElementById('addIncomeModal').classList.remove('hidden');
      document.getElementById('incomeName').value = localStorage.getItem('userName') || '';
      // Update to current real-time when modal opens
      setDefaultDateTime();
    });
    
    // Add Expense FAB click handler
    addExpenseFAB.addEventListener('click', function() {
      document.getElementById('addExpenseModal').classList.remove('hidden');
      document.getElementById('expenseName').value = localStorage.getItem('userName') || '';
      // Update to current real-time when modal opens
      setDefaultDateTime();
    });



    // Profile dropdown logic
    const profileBtn = document.getElementById('profileBtn');
    const profileDropdown = document.getElementById('profileDropdown');
    profileBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      profileDropdown.classList.toggle('hidden');
    });
    document.addEventListener('click', function(e) {
      if (!profileDropdown.classList.contains('hidden')) {
        profileDropdown.classList.add('hidden');
      }
    });
    profileDropdown.addEventListener('click', function(e) {
      e.stopPropagation();
    });

    // Add Income Modal logic
    const addIncomeModal = document.getElementById('addIncomeModal');
    const closeIncomeModal = document.getElementById('closeIncomeModal');
    closeIncomeModal.addEventListener('click', function() {
      addIncomeModal.classList.add('hidden');
    });
    addIncomeModal.addEventListener('click', function(e) {
      if (e.target === addIncomeModal) {
        addIncomeModal.classList.add('hidden');
      }
    });
    // Prevent modal close on inner click
    addIncomeModal.querySelector('form').addEventListener('click', function(e) {
      e.stopPropagation();
    });
    // (Optional) Handle form submit
    // document.getElementById('incomeForm').addEventListener('submit', function(e) {
    //   e.preventDefault();
    //   // Handle form data here
    //   addIncomeModal.classList.add('hidden');
    // });

    // Add Expense Modal logic
    const addExpenseModal = document.getElementById('addExpenseModal');
    const closeExpenseModal = document.getElementById('closeExpenseModal');
    closeExpenseModal.addEventListener('click', function() {
      addExpenseModal.classList.add('hidden');
    });
    addExpenseModal.addEventListener('click', function(e) {
      if (e.target === addExpenseModal) {
        addExpenseModal.classList.add('hidden');
      }
    });
    // Prevent modal close on inner click
    addExpenseModal.querySelector('form').addEventListener('click', function(e) {
      e.stopPropagation();
    });
    // (Optional) Handle form submit
    // document.getElementById('expenseForm').addEventListener('submit', function(e) {
    //   e.preventDefault();
    //   // Handle form data here
    //   addExpenseModal.classList.add('hidden');
    // });

    // Navigation logic
    const homeNav = document.getElementById('homeNav');
    const incomeNav = document.getElementById('incomeNav');
    const expenseNav = document.getElementById('expenseNav');
    const homeSection = document.getElementById('homeSection');
    const incomeSection = document.getElementById('incomeSection');
    const expenseSection = document.getElementById('expenseSection');
    const profileSection = document.getElementById('profileSection');
    const navBtns = document.querySelectorAll('.nav-btn');

    function showSection(section) {
      homeSection.classList.add('hidden');
      incomeSection.classList.add('hidden');
      expenseSection.classList.add('hidden');
      profileSection.classList.add('hidden');
      section.classList.remove('hidden');
      // Hide navbar if profile, show otherwise
      const mainNavbar = document.getElementById('mainNavbar');
      if (section === profileSection) {
        mainNavbar.classList.add('hidden');
      } else {
        mainNavbar.classList.remove('hidden');
      }
    }

    function setActive(btn) {
      navBtns.forEach(b => {
        b.classList.remove('bg-indigo-100', 'text-indigo-700', 'active');
        b.classList.remove('dark:bg-gray-700', 'dark:text-indigo-400');
      });
      btn.classList.add('bg-indigo-100', 'text-indigo-700', 'active');
      btn.classList.add('dark:bg-gray-700', 'dark:text-indigo-400');
    }

    // Add this function to close the transaction modal
    function closeTransactionModalIfOpen() {
      const modal = document.getElementById('transactionModal');
      if (modal && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
      }
    }
    // Update tab navigation to close the modal and show/hide FABs
    homeNav.addEventListener('click', function() {
      showSection(homeSection);
      setActive(homeNav);
      closeTransactionModalIfOpen();
      // Hide both FABs on home tab
      addIncomeFAB.classList.add('hidden');
      addExpenseFAB.classList.add('hidden');
    });
    incomeNav.addEventListener('click', function() {
      showSection(incomeSection);
      setActive(incomeNav);
      closeTransactionModalIfOpen();
      // Show income FAB, hide expense FAB
      addIncomeFAB.classList.remove('hidden');
      addExpenseFAB.classList.add('hidden');
    });
    expenseNav.addEventListener('click', function() {
      showSection(expenseSection);
      setActive(expenseNav);
      closeTransactionModalIfOpen();
      // Show expense FAB, hide income FAB
      addExpenseFAB.classList.remove('hidden');
      addIncomeFAB.classList.add('hidden');
    });


const API_BASE = '';

// --- INCOME & EXPENSE LOGIC ---
async function fetchIncomes() {
  const res = await fetch(`${API_BASE}/api/income`);
  return await res.json();
}
async function fetchExpenses() {
  const res = await fetch(`${API_BASE}/api/expense`);
  return await res.json();
}

// --- TOTAL BALANCE & RECENT TRANSACTIONS ---
async function updateHomeTab() {
  const [incomes, expenses] = await Promise.all([fetchIncomes(), fetchExpenses()]);
  // Calculate totals
  const totalIncome = incomes.reduce((sum, inc) => sum + inc.amount, 0);
  const totalExpense = expenses.reduce((sum, exp) => sum + exp.amount, 0);
  const totalBalance = totalIncome - totalExpense;
  // Update total balance in Home tab
  const totalBalanceElem = document.getElementById('totalBalance');
  if (totalBalanceElem) totalBalanceElem.textContent = `${totalBalance.toLocaleString()}`;

  // Merge and sort transactions
  const transactions = [
    ...incomes.map(inc => ({
      ...inc,
      type: 'Income',
      color: 'text-green-700',
      sign: '+',
      icon: '⬆️'
    })),
    ...expenses.map(exp => ({
      ...exp,
      type: 'Expense',
      color: 'text-red-700',
      sign: '-',
      icon: '⬇️'
    }))
  ];
  transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
  const recent = transactions.slice(0, 10);

  // Render recent transactions
  let html = '';
  if (recent.length === 0) {
    html = '<p class="text-gray-500">No recent transactions.</p>';
  } else {
    html = recent.map(tx => `
      <div class="flex justify-between items-center border-b last:border-b-0 py-2 cursor-pointer transaction-row" data-type="${tx.type}" data-source="${tx.source}" data-amount="${tx.amount}" data-date="${tx.date}" data-user="${tx.user}">
        <div class="flex items-center space-x-2">
          <span>${tx.icon}</span>
          <span class="font-semibold">${tx.source}</span>
          <span class="text-xs text-gray-400">(${tx.type})</span>
        </div>
        <div class="${tx.color} font-bold">${tx.sign}₹${tx.amount.toLocaleString('en-IN')}</div>
        <div class="text-xs text-gray-500 ml-2">${new Date(tx.date).toLocaleString('en-IN')}</div>
      </div>
    `).join('');
  }
  document.getElementById('recentTransactions').innerHTML = html;
  addTransactionRowListeners();
}

// Call updateHomeTab on load and when switching to Home
updateHomeTab();
homeNav.addEventListener('click', updateHomeTab);

// --- INCOME LOGIC ---
function renderIncomeTransactions(incomes) {
  const container = document.getElementById('incomeTransactions');
  const symbol = getSelectedCurrencySymbol();
  if (!incomes.length) {
    container.innerHTML = '<p class="text-gray-500">No income transactions yet.</p>';
    document.getElementById('incomeBalance').textContent = symbol + '0';
    return;
  }
  let total = 0;
  container.innerHTML = incomes.map(inc => {
    total += inc.amount;
    return `<div class="bg-white dark:bg-gray-700 p-5 rounded-2xl flex items-center justify-between shadow-md border border-green-100 dark:border-gray-600 hover:shadow-xl transition mb-4 cursor-pointer transaction-row"
      data-type="Income"
      data-id="${inc.id}"
      data-source="${inc.source}"
      data-date="${inc.date}"
      data-user="${inc.user}"
      data-amount="${inc.amount}">
      <div class="font-semibold text-gray-800 dark:text-gray-200 text-lg">${inc.user || 'Unknown'}</div>
      <div class="flex items-center space-x-4">
      <div>
          <p class="font-semibold text-lg text-green-700 dark:text-green-400">+${symbol}${inc.amount.toLocaleString('en-IN')}</p>
      </div>
      </div>
    </div>`;
  }).join('');
  document.getElementById('incomeBalance').textContent = symbol + total;
  addTransactionRowListeners();
  console.log('Income transactions rendered and listeners attached');
}

// --- EXPENSE LOGIC ---
function renderExpenseTransactions(expenses) {
  const container = document.getElementById('expenseTransactions');
  const symbol = getSelectedCurrencySymbol();
  if (!expenses.length) {
    container.innerHTML = '<p class="text-gray-500">No expense transactions yet.</p>';
    document.getElementById('expenseBalance').textContent = symbol + '0';
    return;
  }
  let total = 0;
  container.innerHTML = expenses.map(exp => {
    total += exp.amount;
    return `<div class="bg-white dark:bg-gray-700 p-5 rounded-2xl flex items-center justify-between shadow-md border border-red-100 dark:border-gray-600 hover:shadow-xl transition mb-4 cursor-pointer transaction-row"
      data-type="Expense"
      data-id="${exp.id}"
      data-source="${exp.source}"
      data-date="${exp.date}"
      data-user="${exp.user}"
      data-amount="${exp.amount}">
      <div class="font-semibold text-gray-800 dark:text-gray-200 text-lg">${exp.user || 'Unknown'}</div>
      <div class="flex items-center space-x-4">
      <div>
          <p class="font-semibold text-lg text-red-700 dark:text-red-400">-${symbol}${exp.amount.toLocaleString('en-IN')}</p>
      </div>
      </div>
    </div>`;
  }).join('');
  document.getElementById('expenseBalance').textContent = symbol + total;
  addTransactionRowListeners();
  console.log('Expense transactions rendered and listeners attached');
}

// --- RECENT TRANSACTIONS LOGIC ---
function addTransactionRowListeners() {
  document.querySelectorAll('.transaction-row').forEach(row => {
    if (!row.dataset.listenerAttached) {
      row.addEventListener('click', function() {
        const type = this.dataset.type;
        const amount = parseFloat(this.dataset.amount);
        const isIncome = type === 'Income';
        const symbol = getSelectedCurrencySymbol();
        const transactionId = this.dataset.id;
        const transactionType = this.dataset.type;
        
        // Set type at the top
        const typeDiv = document.getElementById('modalType');
        typeDiv.textContent = isIncome ? 'Income Details' : 'Expense Details';
        typeDiv.className = 'text-3xl font-extrabold mb-6 mt-2 text-black dark:text-white';
        
        // Set amount
        const amountDiv = document.getElementById('modalAmount');
        amountDiv.textContent = `${isIncome ? '+' : '-'}${symbol}${amount.toLocaleString('en-IN')}`;
        amountDiv.className = `text-4xl font-extrabold mb-4 ${isIncome ? 'text-green-600' : 'text-red-600'}`;
        
        // Set other details
        document.getElementById('modalSource').textContent = this.dataset.source;
        document.getElementById('modalDate').textContent = new Date(this.dataset.date).toLocaleString('en-IN');
        document.getElementById('modalUser').textContent = this.dataset.user || 'Unknown';
        
        // Store transaction info for delete functionality
        document.getElementById('transactionModal').dataset.transactionId = transactionId;
        document.getElementById('transactionModal').dataset.transactionType = transactionType;
        document.getElementById('transactionModal').dataset.transactionUser = this.dataset.user;
        
        // Show/hide delete button based on ownership
        const deleteBtn = document.getElementById('deleteTransactionBtn');
        const currentUser = localStorage.getItem('userName');
        const transactionUser = this.dataset.user;
        const isOwner = transactionUser === currentUser;
        
        console.log('Delete button check:', {
          currentUser: currentUser,
          transactionUser: transactionUser,
          isOwner: isOwner
        });
        
        if (deleteBtn) {
          deleteBtn.style.display = isOwner ? 'flex' : 'none';
        }
        
        document.getElementById('transactionModal').classList.remove('hidden');
      });
      row.dataset.listenerAttached = 'true';
    }
  });
}
// MutationObserver fallback to always attach listeners if DOM changes
const observer = new MutationObserver(() => {
  addTransactionRowListeners();
});
observer.observe(document.body, { childList: true, subtree: true });
console.log('MutationObserver for transaction rows set up');
// Also add listeners for recent transactions after rendering
function renderRecentTransactions(transactions) {
  let html = '';
  if (transactions.length === 0) {
    html = '<p class="text-gray-500">No recent transactions.</p>';
  } else {
    html = transactions.map(tx => `
      <div class="flex justify-between items-center border-b last:border-b-0 py-2 cursor-pointer transaction-row" data-type="${tx.type}" data-id="${tx.id}" data-source="${tx.source}" data-amount="${tx.amount}" data-date="${tx.date}" data-user="${tx.user}">
        <div class="flex items-center space-x-2">
          <span>${tx.icon}</span>
          <span class="font-semibold">${tx.source}</span>
          <span class="text-xs text-gray-400">(${tx.type})</span>
        </div>
        <div class="${tx.color} font-bold">${tx.sign}₹${tx.amount.toLocaleString('en-IN')}</div>
        <div class="text-xs text-gray-500 ml-2">${new Date(tx.date).toLocaleString('en-IN')}</div>
      </div>
    `).join('');
  }
  document.getElementById('recentTransactions').innerHTML = html;
  addTransactionRowListeners();
}
// Update updateHomeTab to use renderRecentTransactions
async function updateHomeTab() {
  const [incomes, expenses] = await Promise.all([fetchIncomes(), fetchExpenses()]);
  const totalIncome = incomes.reduce((sum, inc) => sum + inc.amount, 0);
  const totalExpense = expenses.reduce((sum, exp) => sum + exp.amount, 0);
  const totalBalance = totalIncome - totalExpense;
  document.querySelector('.bg-gradient-to-r h2').textContent = `₹${totalBalance.toLocaleString('en-IN')}`;
  const transactions = [
    ...incomes.map(inc => ({
      ...inc,
      type: 'Income',
      color: 'text-green-700',
      sign: '+',
      icon: '⬆️'
    })),
    ...expenses.map(exp => ({
      ...exp,
      type: 'Expense',
      color: 'text-red-700',
      sign: '-',
      icon: '⬇️'
    }))
  ];
  transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
  const recent = transactions.slice(0, 10);
  renderRecentTransactions(recent);
}
// Modal close logic
const transactionModal = document.getElementById('transactionModal');
const closeTransactionModal = document.getElementById('closeTransactionModal');
const deleteTransactionBtn = document.getElementById('deleteTransactionBtn');

closeTransactionModal.addEventListener('click', function() {
  transactionModal.classList.add('hidden');
});

transactionModal.addEventListener('click', function(e) {
  if (e.target === transactionModal) {
    transactionModal.classList.add('hidden');
  }
});

// Delete transaction functionality
deleteTransactionBtn.addEventListener('click', async function() {
  const transactionId = transactionModal.dataset.transactionId;
  const transactionType = transactionModal.dataset.transactionType;
  const transactionUser = transactionModal.dataset.transactionUser;
  const currentUser = localStorage.getItem('userName');
  
  if (!transactionId || !transactionType) {
    alert('Transaction information not found!');
    return;
  }
  
  // Check if current user is the one who created the transaction
  if (transactionUser !== currentUser) {
    alert('You can only delete your own transactions!');
    return;
  }
  
  // Show confirmation dialog
  const confirmed = confirm(`Are you sure you want to delete this ${transactionType.toLowerCase()} transaction? This action cannot be undone.`);
  
  if (confirmed) {
    try {
      // Delete from backend
      const endpoint = transactionType === 'Income' ? 'income' : 'expense';
      const response = await fetch(`${API_BASE}/${endpoint}/${transactionId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user: currentUser })
      });
      
      if (response.ok) {
        // Close modal
        transactionModal.classList.add('hidden');
        
        // Refresh the current tab
        const currentSection = document.querySelector('.h-screen:not(.hidden)');
        if (currentSection) {
          if (currentSection.id === 'homeSection') {
            updateHomeTab();
          } else if (currentSection.id === 'incomeSection') {
            renderIncomeTransactions(await fetchIncomes());
          } else if (currentSection.id === 'expenseSection') {
            renderExpenseTransactions(await fetchExpenses());
          }
        }
        
        // Show success message
        alert('Transaction deleted successfully!');
      } else {
        const errorData = await response.json();
        alert(errorData.error || 'Failed to delete transaction. Please try again.');
      }
    } catch (error) {
      console.error('Error deleting transaction:', error);
      alert('Error deleting transaction. Please try again.');
    }
  }
});

// --- ADD INCOME ---
document.getElementById('incomeForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const source = document.getElementById('incomeSource').value;
  const amount = parseFloat(document.getElementById('incomeAmount').value);
  const dateTime = document.getElementById('incomeDate').value;
  const user = localStorage.getItem('userName') || '';
  if (!source || isNaN(amount) || !dateTime) return;
  
  // Convert datetime-local to ISO string for backend
  const date = new Date(dateTime);
  
  await fetch(`${API_BASE}/api/income`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ source, amount, user, date: date.toISOString() })
  });
  document.getElementById('addIncomeModal').classList.add('hidden');
  document.getElementById('incomeForm').reset();
  if (!document.getElementById('incomeSection').classList.contains('hidden')) {
    renderIncomeTransactions(await fetchIncomes());
  }
  fetchIncomes().then(renderIncomeTransactions);
  fetchExpenses().then(renderExpenseTransactions);
});

// --- ADD EXPENSE ---
document.getElementById('expenseForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const source = document.getElementById('expenseSource').value;
  const amount = parseFloat(document.getElementById('expenseAmount').value);
  const dateTime = document.getElementById('expenseDate').value;
  const user = localStorage.getItem('userName') || '';
  if (!source || isNaN(amount) || !dateTime) return;
  
  // Convert datetime-local to ISO string for backend
  const date = new Date(dateTime);
  
  await fetch(`${API_BASE}/api/expense`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ source, amount, user, date: date.toISOString() })
  });
  document.getElementById('addExpenseModal').classList.add('hidden');
  document.getElementById('expenseForm').reset();
  // Refresh expense list if on expense tab
  if (!document.getElementById('expenseSection').classList.contains('hidden')) {
    renderExpenseTransactions(await fetchExpenses());
  }
  fetchIncomes().then(renderIncomeTransactions);
  fetchExpenses().then(renderExpenseTransactions);
});

// --- NAVIGATION: Fetch data on tab switch ---
homeNav.addEventListener('click', function() {
  // Optionally, refresh home data here
});
incomeNav.addEventListener('click', async function() {
  renderIncomeTransactions(await fetchIncomes());
});
expenseNav.addEventListener('click', async function() {
  renderExpenseTransactions(await fetchExpenses());
});

// Initial load: fetch income and expense if those tabs are visible
if (!document.getElementById('incomeSection').classList.contains('hidden')) {
  fetchIncomes().then(renderIncomeTransactions);
      addIncomeFAB.classList.remove('hidden');
}
if (!document.getElementById('expenseSection').classList.contains('hidden')) {
  fetchExpenses().then(renderExpenseTransactions);
      addExpenseFAB.classList.remove('hidden');
    }

// Remove static demo cards and render dynamic recent transactions in card style
function renderRecentTransactionCards(transactions) {
  const symbol = getSelectedCurrencySymbol();
  let html = '';
  if (transactions.length === 0) {
    html = '<p class="text-gray-500 dark:text-gray-400">No recent transactions.</p>';
  } else {
    html = transactions.map(tx => `
      <div class="bg-white dark:bg-gray-700 p-5 rounded-2xl flex items-center justify-between shadow-md border border-gray-100 dark:border-gray-600 hover:shadow-xl transition mb-4 cursor-pointer transaction-row"
        data-type="${tx.type}"
        data-id="${tx.id}"
        data-source="${tx.source}"
        data-date="${tx.date}"
        data-user="${tx.user}"
        data-amount="${tx.amount}">
        <div class="font-semibold text-gray-800 dark:text-gray-200 text-lg">${tx.user || 'Unknown'}</div>
        <div class="flex items-center space-x-4">
          <div>
            <p class="font-semibold text-lg ${tx.type === 'Income' ? 'text-green-700 dark:text-green-400' : 'text-red-700 dark:text-red-400'} text-gray-800 dark:text-gray-200">${tx.type === 'Income' ? '+' : '-'}${symbol}${tx.amount.toLocaleString('en-IN')}</p>
          </div>
        </div>
      </div>
    `).join('');
  }
  document.getElementById('recentTransactionCards').innerHTML = html;
  addTransactionRowListeners();
}
// Update updateHomeTab to use renderRecentTransactionCards with date filtering
async function updateHomeTab() {
  const [incomes, expenses] = await Promise.all([fetchIncomes(), fetchExpenses()]);
  
  // Apply date range filter if set
  const startDate = localStorage.getItem('dateRangeStart');
  const endDate = localStorage.getItem('dateRangeEnd');
  
  let filteredIncomes = incomes;
  let filteredExpenses = expenses;
  
  if (startDate && endDate) {
    const start = new Date(startDate);
    const end = new Date(endDate);
    end.setHours(23, 59, 59, 999); // Include the entire end date
    
    filteredIncomes = incomes.filter(inc => {
      const transactionDate = new Date(inc.date);
      return transactionDate >= start && transactionDate <= end;
    });
    
    filteredExpenses = expenses.filter(exp => {
      const transactionDate = new Date(exp.date);
      return transactionDate >= start && transactionDate <= end;
    });
  }
  
  const totalIncome = filteredIncomes.reduce((sum, inc) => sum + inc.amount, 0);
  const totalExpense = filteredExpenses.reduce((sum, exp) => sum + exp.amount, 0);
  const totalBalance = totalIncome - totalExpense;
  document.querySelector('.bg-gradient-to-r h2').textContent = `₹${totalBalance.toLocaleString('en-IN')}`;
  
  const transactions = [
    ...filteredIncomes.map(inc => ({
      ...inc,
      type: 'Income',
    })),
    ...filteredExpenses.map(exp => ({
      ...exp,
      type: 'Expense',
    }))
  ];
  transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
  const recent = transactions.slice(0, 10);
  
  // Populate user filter
  const userSet = new Set(transactions.map(tx => tx.user).filter(Boolean));
  const userFilter = document.getElementById('userFilterHome');
  if (userFilter) {
    const current = userFilter.value;
    userFilter.innerHTML = '<option value="all">All</option>' +
      Array.from(userSet).map(u => `<option value="${u}">${u}</option>`).join('');
    userFilter.value = current && (current === 'all' || userSet.has(current)) ? current : 'all';
    userFilter.onchange = () => {
      renderRecentTransactionCards(
        userFilter.value === 'all' ? recent : recent.filter(tx => tx.user === userFilter.value)
      );
    };
    // Initial filter
    renderRecentTransactionCards(
      userFilter.value === 'all' ? recent : recent.filter(tx => tx.user === userFilter.value)
    );
  } else {
    renderRecentTransactionCards(recent);
  }
}



    // Show user name when 'Your Profile' is clicked
    const yourProfileBtn = profileDropdown.querySelector('button:first-child');
    const profileAvatarImg = document.getElementById('profileAvatarImg');
    yourProfileBtn.addEventListener('click', function() {
      document.getElementById('profileName').textContent = localStorage.getItem('userName') || 'Unknown';
      document.getElementById('profileEmail').textContent = localStorage.getItem('userEmail') || '';
      loadSavedAvatar();
      showSection(profileSection);
      profileDropdown.classList.add('hidden');
    });

    // Function to load saved avatar everywhere
    function loadSavedAvatar() {
      const avatarData = localStorage.getItem('userAvatar');
      if (avatarData) {
        // Update all profile images in the app
        const allProfileImages = document.querySelectorAll('img[src*="profile"], img[src*="avatar"], img[src*="user"], #profileAvatarImg, #profileBtn');
        allProfileImages.forEach(img => {
          if (img.id === 'profileAvatarImg' || img.id === 'profileBtn' || 
              img.src.includes('profile') || img.src.includes('avatar') || img.src.includes('user')) {
            img.src = avatarData;
          }
        });
      }
    }

    // Load saved avatar on page load
    loadSavedAvatar();





    // Change password logic (frontend only, for demo)
    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const current = document.getElementById('currentPassword').value;
      const newPass = document.getElementById('newPassword').value;
      const confirm = document.getElementById('confirmNewPassword').value;
      const msg = document.getElementById('passwordChangeMsg');
      msg.textContent = '';
      if (newPass !== confirm) {
        msg.textContent = 'New passwords do not match.';
        msg.className = 'text-red-600 text-center text-sm mt-2';
        return;
      }
      if (newPass.length < 6) {
        msg.textContent = 'Password must be at least 6 characters.';
        msg.className = 'text-red-600 text-center text-sm mt-2';
        return;
      }
      // Here you would send a request to the backend to change the password
      msg.textContent = 'Password updated successfully!';
      msg.className = 'text-green-600 text-center text-sm mt-2';
      this.reset();
    });

    // Add click handler for profileAppHeader to go back to dashboard
    const profileAppHeader = document.getElementById('profileAppHeader');
    if (profileAppHeader) {
      profileAppHeader.onclick = function() {
        showSection(homeSection);
        setActive(homeNav);
      };
    }

    // Profile Section Navbar Event Handlers
    const profileGoToDashboard = document.getElementById('profileGoToDashboard');
    const profileSectionProfileBtn = document.getElementById('profileSectionProfileBtn');
    const profileSectionDropdown = document.getElementById('profileSectionDropdown');



    // Profile Navbar Dashboard Button
    const profileNavbarDashboardBtn = document.getElementById('profileNavbarDashboardBtn');
    if (profileNavbarDashboardBtn) {
      profileNavbarDashboardBtn.addEventListener('click', function() {
        showSection(homeSection);
        setActive(homeNav);
      });
    }



    // Update existing profile photo logic to also update profile section button
    if (profilePhotoInput) {
      profilePhotoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(evt) {
            // Update all profile images throughout the app
            profileAvatarImg.src = evt.target.result;
            profileBtn.src = evt.target.result;
            
            // Update any other profile images in the app
            const allProfileImages = document.querySelectorAll('img[src*="profile"], img[src*="avatar"], img[src*="user"]');
            allProfileImages.forEach(img => {
              if (img.src.includes('profile') || img.src.includes('avatar') || img.src.includes('user')) {
                img.src = evt.target.result;
              }
            });
            
            localStorage.setItem('userAvatar', evt.target.result);
            
            // Show success message
            showMessage('Profile photo updated successfully!', 'success');
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Show a floating message at the top of the page
    function showMessage(msg, type = 'info') {
      let msgBox = document.getElementById('floatingMessageBox');
      if (!msgBox) {
        msgBox = document.createElement('div');
        msgBox.id = 'floatingMessageBox';
        msgBox.className = 'fixed top-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg text-white text-lg font-semibold transition-all duration-300';
        document.body.appendChild(msgBox);
      }
      msgBox.textContent = msg;
      msgBox.classList.remove('bg-green-600', 'bg-blue-600', 'bg-red-600', 'bg-indigo-600', 'bg-gray-800', 'opacity-0');
      if (type === 'success') msgBox.classList.add('bg-green-600');
      else if (type === 'info') msgBox.classList.add('bg-indigo-600');
      else if (type === 'error') msgBox.classList.add('bg-red-600');
      else msgBox.classList.add('bg-gray-800');
      msgBox.classList.remove('opacity-0');
      setTimeout(() => {
        msgBox.classList.add('opacity-0');
      }, 2000);
}

function getSelectedCurrencySymbol() {
  const country = localStorage.getItem('selectedCountry') || 'IN';
  const countryData = countryCurrencyMap[country];
  return countryData ? countryData.symbol : '₹';
}

// In all rendering functions, replace hardcoded ₹ with getSelectedCurrencySymbol()
// Example for balances:
function renderBalances(totalIncome, totalExpense) {
  const symbol = getSelectedCurrencySymbol();
  const balance = totalIncome - totalExpense;
  const totalBalanceElem = document.getElementById('totalBalance');
  if (totalBalanceElem) totalBalanceElem.textContent = `${symbol}${balance.toLocaleString()}`;
  const incomeBalanceElem = document.getElementById('incomeBalance');
  if (incomeBalanceElem) incomeBalanceElem.textContent = `${symbol}${totalIncome.toLocaleString()}`;
  const expenseBalanceElem = document.getElementById('expenseBalance');
  if (expenseBalanceElem) expenseBalanceElem.textContent = `${symbol}${totalExpense.toLocaleString()}`;
}

// After country change, call renderBalances and re-render transactions
countrySelect.addEventListener('change', function() {
  const country = this.value;
  localStorage.setItem('selectedCountry', country);
  updateDateTimeFormat();
  // Re-render balances and transactions
  renderBalances(totalIncome, totalExpense); // Make sure totalIncome/totalExpense are in scope or recalculate
  updateHomeTab();
  if (!document.getElementById('incomeSection').classList.contains('hidden')) {
    fetchIncomes().then(renderIncomeTransactions);
  }
  if (!document.getElementById('expenseSection').classList.contains('hidden')) {
    fetchExpenses().then(renderExpenseTransactions);
  }
});
</script>
<style>
@keyframes fadeIn { from { opacity: 0; transform: scale(0.95);} to { opacity: 1; transform: scale(1);} }
.animate-fadeIn { animation: fadeIn 0.2s ease; }
</style>
</body>
</html>
